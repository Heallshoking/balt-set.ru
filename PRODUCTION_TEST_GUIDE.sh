#!/bin/bash

# ๐ PRODUCTION TEST GUIDE
# ะะพะปะฝัะน ะณะฐะนะด ะฟะพ ัะตััะธัะพะฒะฐะฝะธั ะฟะตัะตะด ะดะตะฟะปะพะตะผ

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ PRODUCTION TEST GUIDE"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

cat << 'EOF'
## ะจะะ 1: ะะะะะะฌะะะ ะขะะกะขะะะะะะะะ

### 1.1 ะะฐะฟัััะธัั ัะตัะฒะตั

```bash
# ะััะฐะฝะพะฒะธัั ะฟัะตะดัะดััะธะน (ะตัะปะธ ะตััั)
pkill -f "uvicorn main:app"

# ะะฐะฟัััะธัั ะฝะพะฒัะน
python3 -m uvicorn main:app --reload --port 8000
```

**ะัะพะฒะตัะธัั ััะพ ะฟะพัะฒะธะปะพัั:**
```
INFO:     Uvicorn running on http://0.0.0.0:8000
โ Static files ะผะพะฝัะธัะพะฒะฐะฝั ัะตัะตะท /static
๐ AI Service Platform ะทะฐะฟััะตะฝ (Environment: production)
```

---

### 1.2 ะัะบัััั ะฒ ะฑัะฐัะทะตัะต

**ะัะฝะพะฒะฝัะต ัััะฐะฝะธัั:**
- http://localhost:8000/ - ะะปะฐะฒะฝะฐั (ะดะพะปะถะฝะฐ ะทะฐะณััะทะธัััั ะบัะฐัะธะฒะพ)
- http://localhost:8000/admin - ะะดะผะธะฝ-ะฟะฐะฝะตะปั
- http://localhost:8000/master - ะะฐะฑะธะฝะตั ะผะฐััะตัะฐ
- http://localhost:8000/docs - Swagger API
- http://localhost:8000/health - Health check

**ะัะพะฒะตัะธัั:**
- โ ะะตั ะพัะธะฑะพะบ 404
- โ ะะธะทะฐะนะฝ ะทะฐะณััะถะฐะตััั
- โ ะคะพัะผั ัะฐะฑะพัะฐัั
- โ API ะพัะฒะตัะฐะตั

---

### 1.3 ะะฐะฟัััะธัั ะฐะฒัะพะผะฐัะธัะตัะบะธะต ัะตััั

```bash
./test_production.sh
```

**ะะพะปะถะฝะพ ะฑััั:**
- โ ะัะต endpoints ะพัะฒะตัะฐัั
- โ JSON ะฒะฐะปะธะดะฝัะน
- โ ะะฐะทะฐ ะดะฐะฝะฝัั ัะฐะฑะพัะฐะตั
- โ ะคะฐะนะปั ะฝะฐ ะผะตััะต

---

### 1.4 ะัะพะฒะตัะธัั ะฑะฐะทั ะดะฐะฝะฝัั

```bash
# ะะพัะผะพััะตัั ััััะบัััั
sqlite3 data/ai_service.db ".schema"

# ะะพัะผะพััะตัั ะผะฐััะตัะพะฒ
sqlite3 data/ai_service.db "SELECT * FROM masters;"

# ะะพัะผะพััะตัั ะทะฐะบะฐะทั
sqlite3 data/ai_service.db "SELECT * FROM jobs;"

# ะะพะฑะฐะฒะธัั ัะตััะพะฒะพะณะพ ะผะฐััะตัะฐ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
sqlite3 data/ai_service.db "
INSERT INTO masters (full_name, phone, specializations, city, rating, is_active, terminal_active) 
VALUES ('ะะฒะฐะฝ ะขะตััะพะฒัะน', '+79001234567', '[\"electrical\"]', 'ะะฐะปะธะฝะธะฝะณัะฐะด', 5.0, 1, 1);
"
```

---

## ะจะะ 2: ะขะะกะขะะะะะะะะ API

### 2.1 ะกะพะทะดะฐัั ัะตััะพะฒัั ะทะฐัะฒะบั

```bash
curl -X POST http://localhost:8000/api/v1/ai/web-form \
  -H "Content-Type: application/json" \
  -d '{
    "name": "ะขะตััะพะฒัะน ะะปะธะตะฝั",
    "phone": "+79991234567",
    "category": "electrical",
    "problem_description": "ะะต ัะฐะฑะพัะฐะตั ัะพะทะตัะบะฐ ะฒ ะณะพััะธะฝะพะน, ะธัะบัะธั ะฟัะธ ะฒะบะปััะตะฝะธะธ",
    "address": "ัะป. ะะตะฝะธะฝะฐ 10, ะบะฒ. 5"
  }' | python3 -m json.tool
```

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
```json
{
  "success": true,
  "job_id": 1,
  "estimated_price": 1500,
  "master_assigned": true,
  "master_id": 1,
  "message": "ะะฐัะฒะบะฐ ะฟัะธะฝััะฐ! ะะฐััะตั #1 ะฝะฐะทะฝะฐัะตะฝ."
}
```

---

### 2.2 ะัะพะฒะตัะธัั ัะพะทะดะฐะฝะฝัะน ะทะฐะบะฐะท

```bash
curl http://localhost:8000/api/v1/jobs | python3 -m json.tool
```

---

### 2.3 ะะพะปััะธัั ััะฐัะธััะธะบั

```bash
curl http://localhost:8000/api/v1/stats | python3 -m json.tool
```

---

## ะจะะ 3: ะขะะกะขะะะะะะะะ TELEGRAM ะะะขะะ (ะะะฆะะะะะะฌะะ)

### 3.1 ะะพั ะดะปั ะบะปะธะตะฝัะพะฒ

**ะัะปะธ ะตััั ัะพะบะตะฝ:**

```bash
# ะกะพะทะดะฐัั .env ัะฐะนะป
cat > .env << 'ENVFILE'
TELEGRAM_CLIENT_BOT_TOKEN=YOUR_TOKEN_HERE
API_URL=http://localhost:8000
ENVFILE

# ะะฐะฟัััะธัั ะฑะพัะฐ
python3 telegram_client_bot.py
```

**ะัะพัะตััะธัะพะฒะฐัั:**
1. ะะฐะนัะธ ะฑะพัะฐ ะฒ Telegram
2. /start
3. ะัะพะนัะธ ะฒะตัั ะดะธะฐะปะพะณ
4. ะัะพะฒะตัะธัั ััะพ ะทะฐัะฒะบะฐ ะฟะพัะฒะธะปะฐัั ะฒ ะฐะดะผะธะฝะบะต

---

### 3.2 ะะพั ะดะปั ะผะฐััะตัะพะฒ

```bash
# ะะพะฑะฐะฒะธัั ะฒ .env
echo "TELEGRAM_MASTER_BOT_TOKEN=YOUR_TOKEN_HERE" >> .env

# ะะฐะฟัััะธัั
python3 telegram_master_bot.py
```

**ะัะพัะตััะธัะพะฒะฐัั:**
1. /start
2. ะะฐัะตะณะธัััะธัะพะฒะฐัััั
3. ะะพัะผะพััะตัั ะฝะพะฒัะต ะทะฐะบะฐะทั
4. ะัะธะฝััั ะทะฐะบะฐะท
5. ะะทะผะตะฝะธัั ััะฐััั

---

## ะจะะ 4: ะะะะะะ ะะ PRODUCTION

### 4.1 ะะพะดะณะพัะพะฒะบะฐ

```bash
# ะัะพะฒะตัะธัั ััะพ ะฒัั ะทะฐะบะพะผะผะธัะตะฝะพ
git status

# ะฃะฑะตะดะธัััั ััะพ .env ะฝะต ะฒ ัะตะฟะพะทะธัะพัะธะธ
cat .gitignore | grep .env
```

---

### 4.2 ะะฐัััะพะธัั Timeweb

**ะะฐะนัะธ:** https://timeweb.cloud/my/apps โ ะะฐัะต ะฟัะธะปะพะถะตะฝะธะต โ ะะฐัััะพะนะบะธ

**ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:**
```
DEBUG=false
ENVIRONMENT=production
DATABASE_PATH=/app/data/ai_service.db
TELEGRAM_CLIENT_BOT_TOKEN=<ะตัะปะธ_ะตััั>
TELEGRAM_MASTER_BOT_TOKEN=<ะตัะปะธ_ะตััั>
```

---

### 4.3 ะะฐะดะตะฟะปะพะธัั

```bash
# ะัะฟะพะปัะทะพะฒะฐัั quick_deploy
./quick_deploy.sh "Production ready: final testing complete"

# ะะะ ะฒัััะฝัั
git add .
git commit -m "Production ready: final testing complete"
git push origin main
```

**ะะดะฐัั:** 2-3 ะผะธะฝััั

---

### 4.4 ะัะพะฒะตัะธัั production

```bash
# ะะฐะฟัััะธัั ัะตััั ะฝะฐ production
./test_production.sh https://app.balt-set.ru

# ะะปะธ ะฒัััะฝัั
curl https://app.balt-set.ru/health | python3 -m json.tool
curl https://app.balt-set.ru/api | python3 -m json.tool
```

**ะัะบัััั ะฒ ะฑัะฐัะทะตัะต:**
- https://app.balt-set.ru/
- https://app.balt-set.ru/admin
- https://app.balt-set.ru/master
- https://app.balt-set.ru/docs

---

## ะจะะ 5: ะะะะะขะะะะะ

### 5.1 ะัะพะฒะตัะธัั ะปะพะณะธ ะฝะฐ Timeweb

1. ะะฐะนัะธ: https://timeweb.cloud/my/apps
2. ะัะฑัะฐัั ะฟัะธะปะพะถะตะฝะธะต
3. ะะบะปะฐะดะบะฐ "ะะพะณะธ"
4. ะัะพะฒะตัะธัั ััะพ ะฝะตั ะพัะธะฑะพะบ

---

### 5.2 ะกะพะทะดะฐัั ัะตััะพะฒัั ะทะฐัะฒะบั ะฝะฐ production

```bash
curl -X POST https://app.balt-set.ru/api/v1/ai/web-form \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Production Test",
    "phone": "+79991234567",
    "category": "electrical",
    "problem_description": "Test order from production",
    "address": "Test Address 1"
  }' | python3 -m json.tool
```

---

### 5.3 ะัะพะฒะตัะธัั ะฑะฐะทั ะดะฐะฝะฝัั (ะพะฟัะธะพะฝะฐะปัะฝะพ)

**ะงะตัะตะท Timeweb SSH (ะตัะปะธ ะดะพัััะฟะตะฝ):**
```bash
sqlite3 /app/data/ai_service.db "SELECT * FROM jobs ORDER BY id DESC LIMIT 5;"
```

---

## ะจะะ 6: ะคะะะะะฌะะซะ ะงะะะะะกะข

### ะัะธัะธัะตัะบะธะต ะฟัะพะฒะตัะบะธ

- [ ] โ ะกะตัะฒะตั ะทะฐะฟััะบะฐะตััั ะฑะตะท ะพัะธะฑะพะบ
- [ ] โ ะัะต endpoints ะพัะฒะตัะฐัั (200)
- [ ] โ ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ ะทะฐะณััะถะฐะตััั
- [ ] โ Admin ะฟะฐะฝะตะปั ัะฐะฑะพัะฐะตั
- [ ] โ ะะฐะทะฐ ะดะฐะฝะฝัั ัะพะทะดะฐัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ
- [ ] โ API ะฟัะธะฝะธะผะฐะตั ะทะฐัะฒะบะธ
- [ ] โ ะกัะฐัะธััะธะบะฐ ะทะฐะณััะถะฐะตััั
- [ ] โ ะะตั ะบัะธัะธัะตัะบะธั ะพัะธะฑะพะบ ะฒ ะปะพะณะฐั
- [ ] โ Static ัะฐะนะปั ะพัะดะฐัััั
- [ ] โ CORS ะฝะฐัััะพะตะฝ

### ะะตะปะฐัะตะปัะฝัะต ะฟัะพะฒะตัะบะธ

- [ ] Telegram ะฑะพัั ัะฐะฑะพัะฐัั (ะตัะปะธ ะฝะฐัััะพะตะฝั)
- [ ] Google Calendar ัะฐะฑะพัะฐะตั (ะตัะปะธ ะฝะฐัััะพะตะฝ)
- [ ] ะะฐะปัะบัะปััะพั ัะตะฝ ัะพัะฝัะน
- [ ] Email ัะฒะตะดะพะผะปะตะฝะธั (ะตัะปะธ ะฝะฐัััะพะตะฝั)

---

## ะะะขะะะ! ๐

**ะัะปะธ ะฒัะต ัะตะบะปะธััั ะฟัะพะนะดะตะฝั:**
```
โ ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะฟัะพะดะฐะบัะฝั!
โ ะะพะถะฝะพ ะดะพะฑะฐะฒะปััั ัะตะฐะปัะฝัั ะผะฐััะตัะพะฒ
โ ะะพะถะฝะพ ะทะฐะฟััะบะฐัั ัะตะบะปะฐะผั
โ ะะพะถะฝะพ ะฟัะธะฝะธะผะฐัั ะบะปะธะตะฝัะพะฒ
```

**ะกะปะตะดัััะธะต ัะฐะณะธ:**
1. ะะพะฑะฐะฒะธัั 2-3 ัะตะฐะปัะฝัั ะผะฐััะตัะฐ
2. ะกะพะทะดะฐัั 5-10 ัะตััะพะฒัั ะทะฐัะฒะพะบ
3. ะกะพะฑัะฐัั feedback
4. ะะฟัะธะผะธะทะธัะพะฒะฐัั ัะทะบะธะต ะผะตััะฐ
5. ะะฐัััะฐะฑะธัะพะฒะฐัั! ๐

---

## ๐ ะะะะะะะซะ ะกะกะซะะะ

**Production:**
- https://app.balt-set.ru - ะะปะฐะฒะฝะฐั
- https://app.balt-set.ru/admin - ะะดะผะธะฝ
- https://app.balt-set.ru/docs - API Docs

**ะะฐะฝะตะปะธ:**
- https://timeweb.cloud/my/apps - Timeweb ะฟะฐะฝะตะปั
- https://github.com/Heallshoking/balt-set.ru - GitHub

**ะะพะบะฐะปัะฝะพ:**
- http://localhost:8000 - Dev ัะตัะฒะตั
- http://localhost:8000/docs - Swagger

EOF

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ ะะฐะนะด ะพัะพะฑัะฐะถัะฝ ะฒััะต โฌ๏ธ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ะะฐัะธะฝะฐะนัะต ั ะจะะ 1: ะะะะะะฌะะะ ะขะะกะขะะะะะะะะ"
echo ""
