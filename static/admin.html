<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - AI Service Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stats-pills {
            display: flex;
            gap: 1rem;
        }

        .pill {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .pill-success { background: #d1fae5; color: #065f46; }
        .pill-warning { background: #fef3c7; color: #92400e; }
        .pill-info { background: #dbeafe; color: #1e40af; }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Cards Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .icon-primary { background: #dbeafe; }
        .icon-success { background: #d1fae5; }
        .icon-warning { background: #fef3c7; }

        .card-title {
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
        }

        .card-change {
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .change-positive { color: var(--success); }
        .change-negative { color: var(--danger); }

        /* Table */
        .table-container {
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.125rem;
            font-weight: 700;
        }

        .filters {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 1rem 1.5rem;
            background: var(--bg);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        td {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            font-size: 0.875rem;
        }

        tr:hover {
            background: var(--bg);
        }

        /* Status Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-pending { background: #fef3c7; color: #92400e; }
        .badge-accepted { background: #dbeafe; color: #1e40af; }
        .badge-in-progress { background: #e0e7ff; color: #4338ca; }
        .badge-completed { background: #d1fae5; color: #065f46; }
        .badge-cancelled { background: #fee2e2; color: #991b1b; }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        /* Button */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tabs */
        .tabs {
            background: var(--card);
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 0.5rem;
            border: 1px solid var(--border);
        }

        .tab-btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-muted);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .tab-btn:hover {
            color: var(--primary);
            background: var(--bg);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card);
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--bg);
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--text-muted);
        }

        .close-btn:hover {
            background: var(--border);
        }

        /* Form */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.875rem;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-label:hover {
            background: var(--bg);
        }

        .checkbox-label input {
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-secondary {
            background: var(--bg);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .action-btn-edit {
            background: #dbeafe;
            color: #1e40af;
        }

        .action-btn-edit:hover {
            background: #bfdbfe;
        }

        .action-btn-delete {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-btn-delete:hover {
            background: #fecaca;
        }

        /* Mobile */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .stats-pills {
                flex-wrap: wrap;
                justify-content: center;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .table-header {
                flex-direction: column;
                gap: 1rem;
            }

            .filters {
                width: 100%;
                overflow-x: auto;
            }

            table {
                font-size: 0.75rem;
            }

            th, td {
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">ü§ñ AI Service Admin</div>
            <div class="stats-pills">
                <div class="pill pill-success" id="onlineMasters">0 –º–∞—Å—Ç–µ—Ä–æ–≤ –æ–Ω–ª–∞–π–Ω</div>
                <div class="pill pill-warning" id="pendingJobs">0 –≤ –æ—á–µ—Ä–µ–¥–∏</div>
                <div class="pill pill-info" id="todayJobs">0 —Å–µ–≥–æ–¥–Ω—è</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">
                <i class="fas fa-chart-line"></i> Dashboard
            </button>
            <button class="tab-btn" onclick="switchTab('masters')">
                <i class="fas fa-users"></i> –ú–∞—Å—Ç–µ—Ä–∞
            </button>
            <button class="tab-btn" onclick="switchTab('jobs')">
                <i class="fas fa-clipboard-list"></i> –ó–∞–∫–∞–∑—ã
            </button>
            <button class="tab-btn" onclick="switchTab('finance')">
                <i class="fas fa-dollar-sign"></i> –§–∏–Ω–∞–Ω—Å—ã
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
        <!-- Stats Cards -->
        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-primary">üìã</div>
                    <div>
                        <div class="card-title">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                    </div>
                </div>
                <div class="card-value" id="totalJobs">0</div>
                <div class="card-change change-positive" id="jobsChange">+0% –∑–∞ –Ω–µ–¥–µ–ª—é</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-success">üë®‚Äçüîß</div>
                    <div>
                        <div class="card-title">–ê–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–æ–≤</div>
                    </div>
                </div>
                <div class="card-value" id="activeMasters">0</div>
                <div class="card-change change-positive" id="mastersChange">+0 –Ω–æ–≤—ã—Ö</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-warning">üí∞</div>
                    <div>
                        <div class="card-title">–í—ã—Ä—É—á–∫–∞ (–º–µ—Å—è—Ü)</div>
                    </div>
                </div>
                <div class="card-value" id="monthRevenue">0 ‚ÇΩ</div>
                <div class="card-change change-positive" id="revenueChange">+0%</div>
            </div>
        </div>

        <!-- Jobs Table -->
        <div class="table-container">
            <div class="table-header">
                <div class="table-title">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</div>
                <div class="filters">
                    <button class="filter-btn active" onclick="filterJobs('all')">–í—Å–µ</button>
                    <button class="filter-btn" onclick="filterJobs('pending')">–û–∂–∏–¥–∞—é—Ç</button>
                    <button class="filter-btn" onclick="filterJobs('in_progress')">–í —Ä–∞–±–æ—Ç–µ</button>
                    <button class="filter-btn" onclick="filterJobs('completed')">–ó–∞–≤–µ—Ä—à–µ–Ω—ã</button>
                </div>
            </div>
            <div id="jobsTableContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
                </div>
            </div>
        </div>
        </div>

        <!-- Masters Tab -->
        <div id="masters" class="tab-content">
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">üë®‚Äçüîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞–º–∏</div>
                    <button class="btn btn-primary" onclick="openAddMasterModal()">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Ç–µ—Ä–∞
                    </button>
                </div>
                <div id="mastersTableContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Jobs Management Tab -->
        <div id="jobs" class="tab-content">
        <div class="table-container">
            <div class="table-header">
                <div class="table-title">üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</div>
                <div class="filters">
                    <button class="filter-btn active" onclick="filterJobsManagement('all')">–í—Å–µ</button>
                    <button class="filter-btn" onclick="filterJobsManagement('pending')">–û–∂–∏–¥–∞—é—Ç</button>
                    <button class="filter-btn" onclick="filterJobsManagement('in_progress')">–í —Ä–∞–±–æ—Ç–µ</button>
                    <button class="filter-btn" onclick="filterJobsManagement('completed')">–ó–∞–≤–µ—Ä—à–µ–Ω—ã</button>
                </div>
            </div>
            <div id="jobsManagementTableContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
                </div>
            </div>
        </div>
        </div>

        <!-- Finance Tab -->
        <div id="finance" class="tab-content">
            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-success">üí∞</div>
                        <div>
                            <div class="card-title">–í–∞—à–∞ –ø—Ä–∏–±—ã–ª—å (25%)</div>
                        </div>
                    </div>
                    <div class="card-value" id="platformProfit">0 ‚ÇΩ</div>
                    <div class="card-change">–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-primary">üë®‚Äçüîß</div>
                        <div>
                            <div class="card-title">–í—ã–ø–ª–∞—Ç—ã –º–∞—Å—Ç–µ—Ä–∞–º (75%)</div>
                        </div>
                    </div>
                    <div class="card-value" id="mastersPayout">0 ‚ÇΩ</div>
                    <div class="card-change">–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-warning">üìä</div>
                        <div>
                            <div class="card-title">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
                        </div>
                    </div>
                    <div class="card-value" id="avgCheck">0 ‚ÇΩ</div>
                    <div class="card-change">–ù–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö</div>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                </div>
                <div id="financeTableContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Master Modal -->
    <div id="addMasterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Ç–µ—Ä–∞</div>
                <button class="close-btn" onclick="closeAddMasterModal()">√ó</button>
            </div>
            <form id="addMasterForm" onsubmit="handleAddMaster(event)">
                <div class="form-group">
                    <label class="form-label">–§–ò–û –º–∞—Å—Ç–µ—Ä–∞ *</label>
                    <input type="text" class="form-input" name="full_name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                    <input type="tel" class="form-input" name="phone" placeholder="+79001234567" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ì–æ—Ä–æ–¥ *</label>
                    <input type="text" class="form-input" name="city" value="–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ *</label>
                    <div class="form-checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="specializations" value="electrical">
                            –≠–ª–µ–∫—Ç—Ä–∏–∫–∞
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="specializations" value="plumbing">
                            –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="specializations" value="appliances">
                            –ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="specializations" value="general">
                            –û–±—â–∏–µ —Ä–∞–±–æ—Ç—ã
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥</label>
                    <input type="number" class="form-input" name="rating" min="1" max="5" step="0.1" value="5.0">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddMasterModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i> –î–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Ç–µ—Ä–∞
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Master Modal -->
    <div id="editMasterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—Ç–µ—Ä–∞</div>
                <button class="close-btn" onclick="closeEditMasterModal()">√ó</button>
            </div>
            <form id="editMasterForm" onsubmit="handleEditMaster(event)">
                <input type="hidden" name="master_id">
                <div class="form-group">
                    <label class="form-label">–§–ò–û –º–∞—Å—Ç–µ—Ä–∞ *</label>
                    <input type="text" class="form-input" name="full_name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                    <input type="tel" class="form-input" name="phone" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ì–æ—Ä–æ–¥ *</label>
                    <input type="text" class="form-input" name="city" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–†–µ–π—Ç–∏–Ω–≥</label>
                    <input type="number" class="form-input" name="rating" min="1" max="5" step="0.1">
                </div>
                <div class="form-group">
                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                    <select class="form-select" name="is_active">
                        <option value="true">–ê–∫—Ç–∏–≤–µ–Ω</option>
                        <option value="false">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="handleDeleteMaster()">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditMasterModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>
        <div class="table-container">


    <script>
        const API_URL = window.location.origin;
        let allJobs = [];
        let allMasters = [];
        let currentFilter = 'all';
        let currentJobsFilter = 'all';
        let currentEditingMasterId = null;

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'masters') {
                loadMasters();
            } else if (tabName === 'jobs') {
                loadJobsManagement();
            } else if (tabName === 'finance') {
                loadFinance();
            }
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –º–∞—Å—Ç–µ—Ä–æ–≤
        function openAddMasterModal() {
            document.getElementById('addMasterModal').classList.add('active');
        }

        function closeAddMasterModal() {
            document.getElementById('addMasterModal').classList.remove('active');
            document.getElementById('addMasterForm').reset();
        }

        function openEditMasterModal(master) {
            currentEditingMasterId = master.id;
            const form = document.getElementById('editMasterForm');
            form.querySelector('[name="master_id"]').value = master.id;
            form.querySelector('[name="full_name"]').value = master.full_name;
            form.querySelector('[name="phone"]').value = master.phone;
            form.querySelector('[name="city"]').value = master.city;
            form.querySelector('[name="rating"]').value = master.rating;
            form.querySelector('[name="is_active"]').value = master.is_active.toString();
            
            document.getElementById('editMasterModal').classList.add('active');
        }

        function closeEditMasterModal() {
            document.getElementById('editMasterModal').classList.remove('active');
            currentEditingMasterId = null;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
        async function handleAddMaster(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // –°–æ–±—Ä–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            const specializations = Array.from(form.querySelectorAll('[name="specializations"]:checked'))
                .map(cb => cb.value);
            
            if (specializations.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é!');
                return;
            }
            
            const masterData = {
                full_name: formData.get('full_name'),
                phone: formData.get('phone'),
                city: formData.get('city'),
                specializations: specializations,
                rating: parseFloat(formData.get('rating'))
            };
            
            try {
                const response = await fetch(`${API_URL}/api/v1/masters/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(masterData)
                });
                
                if (response.ok) {
                    alert('‚úÖ –ú–∞—Å—Ç–µ—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                    closeAddMasterModal();
                    loadMasters();
                } else {
                    const error = await response.json();
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + (error.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Ç–µ—Ä–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            }
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
        async function handleEditMaster(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const masterId = formData.get('master_id');
            
            const masterData = {
                full_name: formData.get('full_name'),
                phone: formData.get('phone'),
                city: formData.get('city'),
                rating: parseFloat(formData.get('rating')),
                is_active: formData.get('is_active') === 'true'
            };
            
            try {
                const response = await fetch(`${API_URL}/api/v1/masters/${masterId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(masterData)
                });
                
                if (response.ok) {
                    alert('‚úÖ –ú–∞—Å—Ç–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!');
                    closeEditMasterModal();
                    loadMasters();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
        async function handleDeleteMaster() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/v1/masters/${currentEditingMasterId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('‚úÖ –ú–∞—Å—Ç–µ—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω!');
                    closeEditMasterModal();
                    loadMasters();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤
        async function loadMasters() {
            try {
                const response = await fetch(`${API_URL}/api/v1/masters`);
                allMasters = await response.json();
                renderMastersTable();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Å—Ç–µ—Ä–æ–≤:', error);
                document.getElementById('mastersTableContainer').innerHTML = `
                    <div class="loading">
                        <p style="color: var(--danger);">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Å—Ç–µ—Ä–æ–≤</p>
                    </div>
                `;
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –º–∞—Å—Ç–µ—Ä–æ–≤
        function renderMastersTable() {
            if (allMasters.length === 0) {
                document.getElementById('mastersTableContainer').innerHTML = `
                    <div class="loading">
                        <p>üë®‚Äçüîß –ù–µ—Ç –º–∞—Å—Ç–µ—Ä–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞!</p>
                    </div>
                `;
                return;
            }

            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–§–ò–û</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>–ì–æ—Ä–æ–¥</th>
                            <th>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</th>
                            <th>–†–µ–π—Ç–∏–Ω–≥</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allMasters.map(master => {
                            const specs = (master.specializations || [])
                                .map(s => {
                                    const names = {
                                        'electrical': '‚ö° –≠–ª–µ–∫—Ç—Ä–∏–∫–∞',
                                        'plumbing': 'üö∞ –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞',
                                        'appliances': 'üîß –¢–µ—Ö–Ω–∏–∫–∞',
                                        'general': 'üõ†Ô∏è –û–±—â–∏–µ'
                                    };
                                    return names[s] || s;
                                })
                                .join(', ');
                            
                            return `
                                <tr>
                                    <td><strong>#${master.id}</strong></td>
                                    <td>
                                        <div style="font-weight: 600;">${master.full_name}</div>
                                    </td>
                                    <td>${master.phone}</td>
                                    <td>${master.city}</td>
                                    <td style="font-size: 0.75rem;">${specs || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                                    <td>
                                        <span style="color: var(--warning); font-weight: 700;">
                                            ‚≠ê ${master.rating.toFixed(1)}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge ${master.is_active ? 'badge-completed' : 'badge-cancelled'}">
                                            <span class="status-dot"></span>
                                            ${master.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn action-btn-edit" 
                                                onclick='openEditMasterModal(${JSON.stringify(master).replace(/'/g, "\\'")})'
                                                title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('mastersTableContainer').innerHTML = html;
            
            // –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –≤ header
            const activeMasters = allMasters.filter(m => m.is_active).length;
            document.getElementById('onlineMasters').textContent = `${activeMasters} –º–∞—Å—Ç–µ—Ä–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ`;
            document.getElementById('activeMasters').textContent = activeMasters;
        }

       // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadData() {
            try {
                // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
                const jobsRes = await fetch(`${API_URL}/api/v1/jobs`);
                allJobs = await jobsRes.json();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                updateStats();
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
                renderJobsTable();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                document.getElementById('jobsTableContainer').innerHTML = `
                    <div class="loading">
                        <p style="color: var(--danger);">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏
        async function loadJobsManagement() {
            try {
                const response = await fetch(`${API_URL}/api/v1/jobs`);
                allJobs = await response.json();
                renderJobsManagementTable();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
                document.getElementById('jobsManagementTableContainer').innerHTML = `
                    <div class="loading">
                        <p style="color: var(--danger);">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤</p>
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤
        async function loadFinance() {
            try {
                const response = await fetch(`${API_URL}/api/v1/jobs`);
                allJobs = await response.json();
                renderFinanceStats();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤:', error);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏
        function renderJobsManagementTable() {
            const filteredJobs = currentJobsFilter === 'all' 
                ? allJobs 
                : allJobs.filter(j => j.status === currentJobsFilter);

            if (filteredJobs.length === 0) {
                document.getElementById('jobsManagementTableContainer').innerHTML = `
                    <div class="loading">
                        <p>üì≠ –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
                    </div>
                `;
                return;
            }

            const statusNames = {
                'pending': '–û–∂–∏–¥–∞–µ—Ç',
                'accepted': '–ü—Ä–∏–Ω—è—Ç',
                'in_progress': '–í —Ä–∞–±–æ—Ç–µ',
                'completed': '–ó–∞–≤–µ—Ä—à—ë–Ω',
                'cancelled': '–û—Ç–º–µ–Ω—ë–Ω'
            };

            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ö–ª–∏–µ–Ω—Ç</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–ü—Ä–æ–±–ª–µ–º–∞</th>
                            <th>–ú–∞—Å—Ç–µ—Ä</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–¶–µ–Ω–∞</th>
                            <th>–ö–æ–º–∏—Å—Å–∏—è (25%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredJobs.map(job => {
                            const commission = (job.estimated_price || 0) * 0.25;
                            return `
                                <tr>
                                    <td><strong>#${job.id}</strong></td>
                                    <td>
                                        <div style="font-weight: 600;">${job.client_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                                        <div style="font-size: 0.75rem; color: var(--text-muted);">${job.client_phone || ''}</div>
                                    </td>
                                    <td style="font-size: 0.75rem;">${job.category_name || job.category || ''}</td>
                                    <td style="max-width: 200px; font-size: 0.75rem;">
                                        ${(job.problem_description || '').substring(0, 50)}...
                                    </td>
                                    <td>
                                        ${job.master_id ? `<span class="badge badge-accepted">–ù–∞–∑–Ω–∞—á–µ–Ω #${job.master_id}</span>` : '<span class="badge badge-pending">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</span>'}
                                    </td>
                                    <td>
                                        <span class="badge badge-${job.status}">
                                            <span class="status-dot"></span>
                                            ${statusNames[job.status] || job.status}
                                        </span>
                                    </td>
                                    <td><strong>${(job.estimated_price || 0).toLocaleString('ru-RU')} ‚ÇΩ</strong></td>
                                    <td>
                                        <strong style="color: var(--success);">${commission.toLocaleString('ru-RU')} ‚ÇΩ</strong>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('jobsManagementTableContainer').innerHTML = html;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function renderFinanceStats() {
            const completedJobs = allJobs.filter(j => j.status === 'completed');
            const totalRevenue = completedJobs.reduce((sum, j) => sum + (j.estimated_price || 0), 0);
            const platformProfit = totalRevenue * 0.25;
            const mastersPayout = totalRevenue * 0.75;
            const avgCheck = completedJobs.length > 0 ? totalRevenue / completedJobs.length : 0;

            document.getElementById('platformProfit').textContent = `${platformProfit.toLocaleString('ru-RU')} ‚ÇΩ`;
            document.getElementById('mastersPayout').textContent = `${mastersPayout.toLocaleString('ru-RU')} ‚ÇΩ`;
            document.getElementById('avgCheck').textContent = `${avgCheck.toLocaleString('ru-RU')} ‚ÇΩ`;

            // –¢–∞–±–ª–∏—Ü–∞ –ø–æ –∑–∞–∫–∞–∑–∞–º
            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>–ó–∞–∫–∞–∑</th>
                            <th>–ú–∞—Å—Ç–µ—Ä</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–ö–æ–º–∏—Å—Å–∏—è (25%)</th>
                            <th>–ú–∞—Å—Ç–µ—Ä—É (75%)</th>
                            <th>–î–∞—Ç–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${completedJobs.slice(0, 20).map(job => {
                            const price = job.estimated_price || 0;
                            const commission = price * 0.25;
                            const masterPayout = price * 0.75;
                            
                            return `
                                <tr>
                                    <td><strong>#${job.id}</strong></td>
                                    <td>${job.master_id ? `–ú–∞—Å—Ç–µ—Ä #${job.master_id}` : '-'}</td>
                                    <td>${price.toLocaleString('ru-RU')} ‚ÇΩ</td>
                                    <td><strong style="color: var(--success);">${commission.toLocaleString('ru-RU')} ‚ÇΩ</strong></td>
                                    <td>${masterPayout.toLocaleString('ru-RU')} ‚ÇΩ</td>
                                    <td style="font-size: 0.75rem; color: var(--text-muted);">
                                        ${job.created_at ? new Date(job.created_at).toLocaleDateString('ru-RU') : ''}
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('financeTableContainer').innerHTML = completedJobs.length > 0 ? html : `
                <div class="loading">
                    <p>üí∞ –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</p>
                </div>
            `;
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function filterJobsManagement(filter) {
            currentJobsFilter = filter;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
            const buttons = document.querySelectorAll('#jobs .filter-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(filter === 'all' ? '–≤—Å–µ' : filter)) {
                    btn.classList.add('active');
                }
            });
            
            renderJobsManagementTable();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const totalJobs = allJobs.length;
            const pendingJobs = allJobs.filter(j => j.status === 'pending').length;
            const completedJobs = allJobs.filter(j => j.status === 'completed').length;
            const todayJobs = allJobs.filter(j => {
                const today = new Date().toISOString().split('T')[0];
                return j.created_at && j.created_at.startsWith(today);
            }).length;

            document.getElementById('totalJobs').textContent = totalJobs;
            document.getElementById('pendingJobs').textContent = `${pendingJobs} –≤ –æ—á–µ—Ä–µ–¥–∏`;
            document.getElementById('todayJobs').textContent = `${todayJobs} —Å–µ–≥–æ–¥–Ω—è`;
            
            // –ü–æ–¥—Å—á–µ—Ç –≤—ã—Ä—É—á–∫–∏
            const revenue = allJobs
                .filter(j => j.status === 'completed')
                .reduce((sum, j) => sum + (j.estimated_price || 0), 0);
            
            document.getElementById('monthRevenue').textContent = `${revenue.toLocaleString('ru-RU')} ‚ÇΩ`;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞–∫–∞–∑–æ–≤
        function renderJobsTable() {
            const filteredJobs = currentFilter === 'all' 
                ? allJobs 
                : allJobs.filter(j => j.status === currentFilter);

            if (filteredJobs.length === 0) {
                document.getElementById('jobsTableContainer').innerHTML = `
                    <div class="loading">
                        <p>üì≠ –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
                    </div>
                `;
                return;
            }

            const statusNames = {
                'pending': '–û–∂–∏–¥–∞–µ—Ç',
                'accepted': '–ü—Ä–∏–Ω—è—Ç',
                'in_progress': '–í —Ä–∞–±–æ—Ç–µ',
                'completed': '–ó–∞–≤–µ—Ä—à—ë–Ω',
                'cancelled': '–û—Ç–º–µ–Ω—ë–Ω'
            };

            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ö–ª–∏–µ–Ω—Ç</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–ê–¥—Ä–µ—Å</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–¶–µ–Ω–∞</th>
                            <th>–î–∞—Ç–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredJobs.slice(0, 20).map(job => `
                            <tr>
                                <td><strong>#${job.id}</strong></td>
                                <td>
                                    <div style="font-weight: 600;">${job.client_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                                    <div style="font-size: 0.75rem; color: var(--text-muted);">${job.client_phone || ''}</div>
                                </td>
                                <td>${job.category_name || job.category || ''}</td>
                                <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                    ${job.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                                </td>
                                <td>
                                    <span class="badge badge-${job.status}">
                                        <span class="status-dot"></span>
                                        ${statusNames[job.status] || job.status}
                                    </span>
                                </td>
                                <td><strong>${(job.estimated_price || 0).toLocaleString('ru-RU')} ‚ÇΩ</strong></td>
                                <td style="font-size: 0.75rem; color: var(--text-muted);">
                                    ${job.created_at ? new Date(job.created_at).toLocaleDateString('ru-RU') : ''}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('jobsTableContainer').innerHTML = html;
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
        function filterJobs(filter) {
            currentFilter = filter;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderJobsTable();
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        setInterval(loadData, 10000);

        // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        loadData();
    </script>
</body>
</html>
