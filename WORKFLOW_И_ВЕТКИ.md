# üîÑ WORKFLOW –ò –°–¢–†–£–ö–¢–£–†–ê –í–ï–¢–û–ö

**–î–∞—Ç–∞:** 13 –¥–µ–∫–∞–±—Ä—è 2025  
**–ü—Ä–æ–µ–∫—Ç:** balt-set.ru

---

## üìä –°–¢–†–£–ö–¢–£–†–ê –í–ï–¢–û–ö

### –í–µ—Ç–∫–∞ `dev` (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
```
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç Qoder
‚úÖ Qoder —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–¥–µ—Å—å: –í—Å–µ commit/push –∏–¥—É—Ç –≤ dev
‚úÖ Auto-deploy: –ù–ï–¢ (—Ç–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞)
```

### –í–µ—Ç–∫–∞ `main` (–ø—Ä–æ–¥–∞–∫—à–Ω)
```
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: Production –∫–æ–¥ –Ω–∞ app.balt-set.ru
‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ merge –∏–∑ dev (–≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ PR)
‚úÖ Auto-deploy: –î–ê ‚Üí Timeweb –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç
```

---

## üéØ WORKFLOW –î–õ–Ø QODER

### 1. –†–∞–±–æ—Ç–∞ –≤ –≤–µ—Ç–∫–µ dev

**–í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞—é –≤ –≤–µ—Ç–∫–µ dev:**
```bash
git checkout dev
# ... –¥–µ–ª–∞—é –∏–∑–º–µ–Ω–µ–Ω–∏—è ...
git add .
git commit -m "feat: –¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—É—é —Ñ–∏—á—É"
git push origin dev
```

### 2. –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Üí merge –≤ main

**–ö–æ–≥–¥–∞ –∫–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ production:**
```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ main
git checkout main

# –ü–æ–¥—Ç—è–≥–∏–≤–∞—é –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# –î–µ–ª–∞—é merge –∏–∑ dev
git merge dev

# –ü—É—à—É –≤ main (—Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç auto-deploy –Ω–∞ Timeweb)
git push origin main
```

### 3. Timeweb –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç

```
GitHub main –≤–µ—Ç–∫–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å
    ‚Üì (webhook)
Timeweb –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª
    ‚Üì (auto-rebuild)
app.balt-set.ru –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (2-3 –º–∏–Ω—É—Ç—ã)
```

---

## ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ê TIMEWEB AUTO-DEPLOY

### –®–∞–≥ 1: –ó–∞–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å Timeweb

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://timeweb.cloud/my/apps
2. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `balt-set.ru`
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–∏—Ç—å GitHub (–µ—Å–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)

–í —Ä–∞–∑–¥–µ–ª–µ **"Source"** –∏–ª–∏ **"GitHub"**:

```
1. –ù–∞–∂–º–∏—Ç–µ "Connect GitHub"
2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ GitHub
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: Heallshoking/balt-set.ru
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É: main
5. –í–∫–ª—é—á–∏—Ç–µ "Auto-deploy"
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Build & Start –∫–æ–º–∞–Ω–¥—ã

**Build Command** (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è):
```bash
pip install -r requirements.txt
```

**Start Command**:
```bash
uvicorn main:app --host 0.0.0.0 --port $PORT
```

–ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Procfile - –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º.

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Environment Variables

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
```
ENVIRONMENT=production
DATABASE_PATH=/app/data/ai_service.db
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Webhook –≤ GitHub

1. –ó–∞–π–¥–∏—Ç–µ: https://github.com/Heallshoking/balt-set.ru/settings/hooks
2. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å webhook –æ—Ç Timeweb
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ "Recent Deliveries" - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (200 OK)

---

## üß™ –ü–†–û–í–ï–†–ö–ê AUTO-DEPLOY

### –¢–µ—Å—Ç 1: –°–¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ dev

```bash
# –í –≤–µ—Ç–∫–µ dev
echo "# Test auto-deploy" >> TEST.md
git add TEST.md
git commit -m "test: –ø—Ä–æ–≤–µ—Ä–∫–∞ workflow"
git push origin dev
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Timeweb –ù–ï –¥–æ–ª–∂–µ–Ω –¥–µ–ø–ª–æ–∏—Ç—å (–≤–µ—Ç–∫–∞ dev)

### –¢–µ—Å—Ç 2: Merge –≤ main

```bash
git checkout main
git merge dev
git push origin main
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- ‚úÖ –ß–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã Timeweb –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∞—Ç—å –¥–µ–ø–ª–æ–π
- ‚úÖ –ß–µ—Ä–µ–∑ 3-5 –º–∏–Ω—É—Ç app.balt-set.ru –æ–±–Ω–æ–≤–∏—Ç—Å—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `curl https://app.balt-set.ru/health`

---

## üìã –ß–ï–ö–õ–ò–°–¢ –ù–ê–°–¢–†–û–ô–ö–ò

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```
‚úÖ –í–µ—Ç–∫–∞ dev —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –∏ –Ω–∞ GitHub
‚úÖ –í–µ—Ç–∫–∞ main –∑–∞—â–∏—â–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚úÖ Timeweb –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
‚úÖ Auto-deploy –≤–∫–ª—é—á–µ–Ω –¥–ª—è –≤–µ—Ç–∫–∏ main
‚úÖ Webhook –æ—Ç Timeweb —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ GitHub
‚úÖ Start Command –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
‚úÖ Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
```

---

## üöÄ –ë–´–°–¢–†–´–ï –ö–û–ú–ê–ù–î–´

### –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ dev –∏ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
```bash
git checkout dev
git pull origin dev
```

### –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ production
```bash
git checkout main
git pull origin main
git merge dev
git push origin main
# –ñ–¥—ë–º 3-5 –º–∏–Ω—É—Ç
curl https://app.balt-set.ru/health
```

### –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å)
```bash
git checkout main
git revert HEAD
git push origin main
```

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú

### –ü—Ä–æ–±–ª–µ–º–∞: Auto-deploy –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. **Webhook –≤ GitHub** - https://github.com/Heallshoking/balt-set.ru/settings/hooks
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å–ø–µ—à–Ω—ã–µ deliveries (200 OK)
   
2. **–õ–æ–≥–∏ Timeweb** - https://timeweb.cloud/my/apps ‚Üí Logs
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–æ–≤—ã–π deployment –ø–æ—Å–ª–µ push
   
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Timeweb** - –í–∫–ª–∞–¥–∫–∞ Settings
   - Auto-deploy –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω
   - –í–µ—Ç–∫–∞ main –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å GitHub –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Timeweb
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Start Command –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –°–¥–µ–ª–∞—Ç—å —Ä—É—á–Ω–æ–π Restart –µ—Å–ª–∏ auto-deploy –∑–∞–≤–∏—Å

### –ü—Ä–æ–±–ª–µ–º–∞: –î–µ–ø–ª–æ–π –µ—Å—Ç—å, –Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –≤–∏–¥–Ω—ã

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+F5)
- –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞ –Ω–∞ Timeweb
- –û—à–∏–±–∫–∞ –≤ build –ø—Ä–æ—Ü–µ—Å—Å–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Runtime Logs –≤ Timeweb
- –°–¥–µ–ª–∞—Ç—å Hard Refresh –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

---

## üí° BEST PRACTICES

### 1. –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ dev

```bash
# –ù–ï –¥–µ–ª–∞—Ç—å:
git checkout main
# ... –∏–∑–º–µ–Ω–µ–Ω–∏—è ...
git push origin main  # ‚ùå –ü–ª–æ—Ö–æ! –°—Ä–∞–∑—É –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω!

# –î–µ–ª–∞—Ç—å:
git checkout dev
# ... –∏–∑–º–µ–Ω–µ–Ω–∏—è ...
git push origin dev  # ‚úÖ –•–æ—Ä–æ—à–æ! –°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ push

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
python3 -m uvicorn main:app --reload --port 8000

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoints
curl http://localhost:8000/health
curl http://localhost:8000/admin

# –ï—Å–ª–∏ –≤—Å—ë –û–ö ‚Üí push
git push origin dev
```

### 3. Merge –≤ main —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∫–æ–¥

```bash
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ dev —Ä–∞–±–æ—Ç–∞–µ—Ç
./check_production.sh

# –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º merge
git checkout main
git merge dev
git push origin main
```

---

## üîó –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò

- üõ†Ô∏è **Timeweb Apps**: https://timeweb.cloud/my/apps
- üíª **GitHub Repo**: https://github.com/Heallshoking/balt-set.ru
- üîó **Webhooks**: https://github.com/Heallshoking/balt-set.ru/settings/hooks
- üåê **Production**: https://app.balt-set.ru
- üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [TIMEWEB_–ù–ê–°–¢–†–û–ô–ö–ê_–ò_–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê.md](./TIMEWEB_–ù–ê–°–¢–†–û–ô–ö–ê_–ò_–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê.md)

---

## ‚úÖ –ò–¢–û–ì–û

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow:**

1. **Qoder —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ dev** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–¥—É—Ç —Ç—É–¥–∞
2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º –≤ dev** - –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **Merge –≤ main** - –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ –∫ production
4. **Timeweb auto-deploy** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç app.balt-set.ru
5. **–ü—Ä–æ–≤–µ—Ä—è–µ–º production** - —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –≤—Å—ë –û–ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π! üöÄ
